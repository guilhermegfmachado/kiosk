<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ´»å­—</title>
  <meta name="description" content="æ´»å­— â€” world press. Quality journalism from 57 outlets in 10 languages.">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;1,300&family=IBM+Plex+Sans:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€ TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg:          #0c0c0c;
      --bg-panel:    #111111;
      --bg-hover:    #181818;
      --bg-active:   #161616;
      --border:      #222222;
      --border-soft: #1a1a1a;
      --text:        #b0b0b0;
      --text-dim:    #555;
      --text-bright: #e8e8e8;
      --accent:      #3df078;
      --accent-dim:  rgba(61,240,120,0.08);
      --red:         #f05050;
      --sidebar:     240px;
      --topbar:      40px;
      --mono:        'IBM Plex Mono', monospace;
      --sans:        'IBM Plex Sans', sans-serif;
    }
    /* â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 15px; }
    @media (max-width: 640px) { html { font-size: 16px; } }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--mono);
      line-height: 1.6;
      height: 100dvh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; cursor: pointer; border: none; background: none; color: inherit; padding: 0; }
    ::-webkit-scrollbar { width: 3px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); }
    /* â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #topbar {
      height: var(--topbar);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--border);
      background: var(--bg-panel);
      padding: 0 1rem;
      gap: 1rem;
    }
    #wordmark {
      font-size: 1rem;
      font-weight: 400;
      letter-spacing: 0.05em;
      color: var(--accent);
      flex-shrink: 0;
      padding-right: 1rem;
      border-right: 1px solid var(--border);
      line-height: 1;
    }
    #search-wrap { flex: 1; max-width: 280px; position: relative; }
    #search-wrap::before {
      content: 'âŒ•';
      position: absolute;
      left: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-dim);
      font-size: 1rem;
      pointer-events: none;
    }
    #search {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: var(--mono);
      font-size: 0.75rem;
      padding: 0.28rem 0.6rem 0.28rem 1.6rem;
      outline: none;
      transition: border-color 0.12s;
    }
    #search::placeholder { color: var(--text-dim); }
    #search:focus { border-color: var(--accent); }
    #topbar-right { margin-left: auto; display: flex; align-items: center; gap: 0.55rem; }
    .t-btn {
      font-size: 0.68rem;
      color: var(--text-dim);
      border: 1px solid var(--border);
      padding: 0.18rem 0.5rem;
      letter-spacing: 0.03em;
      transition: color 0.1s, border-color 0.1s;
    }
    .t-btn:hover, .t-btn.on { color: var(--accent); border-color: var(--accent); }
    #pulse {
      width: 5px; height: 5px; border-radius: 50%;
      background: var(--accent);
      animation: blink 2.5s ease-in-out infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }
    #updated { font-size: 0.62rem; color: var(--text-dim); }
    /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #layout { display: flex; flex: 1; overflow: hidden; }
    /* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #sidebar {
      width: var(--sidebar);
      flex-shrink: 0;
      border-right: 1px solid var(--border);
      background: var(--bg-panel);
      overflow-y: auto;
      overflow-x: hidden;
    }
    .sb-section { border-bottom: 1px solid var(--border-soft); }
    /* category headers in sidebar */
    .sb-cat-header {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.55rem 0.85rem 0.25rem;
      font-size: 0.65rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-dim);
      cursor: pointer;
      user-select: none;
      border-top: 1px solid var(--border-soft);
      transition: color 0.1s;
    }
    .sb-cat-header:first-child { border-top: none; }
    .sb-cat-header:hover { color: var(--text); }
    .sb-cat-header.active { color: var(--accent); }
    .sb-cat-toggle {
      margin-left: auto;
      font-size: 0.6rem;
      opacity: 0.4;
      transition: transform 0.15s;
    }
    .sb-cat-feeds { overflow: hidden; }
    .sb-cat-feeds.collapsed { display: none; }
    .sb-loading {
      padding: 0.3rem 0.85rem 0.3rem 2rem;
      font-size: 0.62rem;
      color: var(--text-dim);
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    .sb-spinner {
      width: 7px; height: 7px;
      border: 1px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.65s linear infinite;
      flex-shrink: 0;
    }
    .sb-head {
      padding: 0.65rem 0.85rem 0.25rem;
      font-size: 0.58rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-dim);
    }
    .sb-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.32rem 0.85rem;
      font-size: 0.73rem;
      color: var(--text-dim);
      cursor: pointer;
      border-left: 2px solid transparent;
      transition: background 0.08s, color 0.08s;
      user-select: none;
    }
    .sb-item:hover { background: var(--bg-hover); color: var(--text); }
    .sb-item.active { color: var(--text-bright); background: var(--bg-active); border-left-color: var(--accent); }
    .sb-flag { font-size: 0.83rem; line-height: 1; flex-shrink: 0; }
    .sb-cc {
      font-size: 0.57rem;
      color: var(--text-dim);
      opacity: 0.45;
      letter-spacing: 0.04em;
      flex-shrink: 0;
      min-width: 1.6rem;
      font-family: var(--mono);
    }
    .sb-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .sb-lang { font-size: 0.57rem; color: var(--text-dim); opacity: 0.5; flex-shrink: 0; }
    .sb-count { font-size: 0.6rem; color: var(--text-dim); flex-shrink: 0; min-width: 18px; text-align: right; }
    /* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #main { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-width: 0; }
    #feed-bar {
      height: 34px; flex-shrink: 0;
      display: flex; align-items: center;
      padding: 0 1rem; border-bottom: 1px solid var(--border);
      gap: 0.8rem; background: var(--bg);
    }
    #feed-name { font-size: 0.76rem; color: var(--text-bright); font-weight: 500; }
    #feed-info { font-size: 0.65rem; color: var(--text-dim); }
    #feed-ctrls { margin-left: auto; display: flex; gap: 0.35rem; }
    .f-btn {
      font-size: 0.65rem; color: var(--text-dim);
      border: 1px solid var(--border); padding: 0.12rem 0.4rem;
      transition: color 0.1s, border-color 0.1s;
    }
    .f-btn:hover, .f-btn.on { color: var(--accent); border-color: var(--accent); }
    /* â”€â”€ ARTICLE LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #articles { flex: 1; overflow-y: auto; }

    .article {
      border-bottom: 1px solid var(--border);
      padding: 0.9rem 1.1rem;
      cursor: pointer;
      transition: background 0.07s;
    }
    .article:hover { background: var(--bg-hover); }
    .article.read { opacity: 0.32; }
    .article.read:hover { opacity: 0.58; }
    .article.active {
      background: var(--bg-active);
      border-left: 2px solid var(--accent);
      padding-left: calc(1.1rem - 2px);
    }

    .a-meta {
      font-size: 0.6rem;
      color: var(--text-dim);
      display: flex;
      align-items: center;
      gap: 0.35rem;
      margin-bottom: 0.3rem;
    }
    .a-cc {
      font-size: 0.57rem;
      color: var(--text-dim);
      opacity: 0.45;
      letter-spacing: 0.04em;
      font-family: var(--mono);
      flex-shrink: 0;
      min-width: 1.6rem;
    }
    .a-src { color: var(--accent); letter-spacing: 0.02em; }
    .a-dot { color: var(--border); }
    .a-lang {
      font-size: 0.55rem;
      border: 1px solid var(--border-soft);
      padding: 0.02rem 0.25rem;
      color: var(--text-dim);
      opacity: 0.6;
    }
    .a-time { margin-left: auto; font-size: 0.57rem; }
    .a-read-time { font-size: 0.57rem; color: var(--text-dim); opacity: 0.45; }

    .a-title {
      font-family: var(--sans);
      font-size: 0.88rem;
      font-weight: 400;
      color: var(--text-bright);
      line-height: 1.45;
      margin-bottom: 0.28rem;
    }
    .article:hover .a-title { color: #fff; }

    .a-desc {
      font-family: var(--sans);
      font-size: 0.73rem;
      color: var(--text-dim);
      line-height: 1.55;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .compact .a-desc { display: none; }

    /* actions row â€” only on hover, desktop */
    .a-actions {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-top: 0.35rem;
      opacity: 0;
      transition: opacity 0.12s;
      height: 0;
      overflow: hidden;
    }
    .article:hover .a-actions {
      opacity: 1;
      height: auto;
    }
    .a-action-btn {
      font-size: 0.6rem;
      color: var(--text-dim);
      transition: color 0.1s;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      font-family: var(--mono);
    }
    .a-action-btn:hover { color: var(--accent); }
    .a-action-btn.saved { color: var(--accent); opacity: 1; }
    .a-open-link {
      font-size: 0.6rem;
      color: var(--text-dim);
      transition: color 0.1s;
    }
    .a-open-link:hover { color: var(--accent); }

    @media (max-width: 640px) {
      /* on mobile, always show actions (no hover state) */
      .a-actions { opacity: 1; height: auto; }
      .article { padding: 0.85rem 0.9rem; }
    }
    .state-row {
      padding: 0.75rem 1rem; font-size: 0.7rem; color: var(--text-dim);
      display: flex; align-items: center; gap: 0.45rem;
    }
    .spinner {
      width: 9px; height: 9px;
      border: 1px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.65s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #empty {
      padding: 5rem 1rem; text-align: center;
      color: var(--text-dim); font-size: 0.72rem;
    }
    #empty::before { content: 'â—ˆ'; display: block; font-size: 1.7rem; opacity: 0.18; margin-bottom: 0.7rem; }
    /* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #footer {
      flex-shrink: 0;
      border-top: 1px solid var(--border-soft);
      background: var(--bg-panel);
      padding: 0.4rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.6rem;
      color: var(--text-dim);
    }
    #footer a {
      color: var(--text-dim);
      transition: color 0.1s;
    }
    #footer a:hover { color: var(--accent); }
    #footer .footer-sep { color: var(--border); margin: 0 0.5rem; }
    #statusbar {
      height: 22px; flex-shrink: 0;
      border-top: 1px solid var(--border); background: var(--bg-panel);
      display: flex; align-items: center;
      padding: 0 1rem; gap: 1.3rem;
      font-size: 0.6rem; color: var(--text-dim);
    }
    #statusbar span { color: var(--text); }
    /* â”€â”€ READER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #reader {
      width: 390px; flex-shrink: 0;
      border-left: 1px solid var(--border);
      background: var(--bg-panel);
      display: flex; flex-direction: column; overflow: hidden;
    }
    #reader.hide { display: none; }
    #reader-top {
      height: 34px; flex-shrink: 0;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; padding: 0 0.75rem; gap: 0.45rem;
    }
    .r-btn {
      font-size: 0.65rem; color: var(--text-dim);
      border: 1px solid var(--border); padding: 0.12rem 0.4rem;
      transition: color 0.1s, border-color 0.1s;
    }
    .r-btn:hover { color: var(--accent); border-color: var(--accent); }
    #r-open { margin-left: auto; }
    #reader-body { flex: 1; overflow-y: auto; padding: 1rem; }
    #r-source {
      font-size: 0.6rem; color: var(--text-dim);
      margin-bottom: 0.55rem;
      display: flex; gap: 0.38rem; align-items: center;
    }
    #r-src { color: var(--accent); }
    #r-title {
      font-family: var(--sans); font-size: 1rem;
      font-weight: 300; color: var(--text-bright);
      line-height: 1.45; margin-bottom: 0.55rem;
    }
    #r-date {
      font-size: 0.6rem; color: var(--text-dim);
      margin-bottom: 0.9rem; padding-bottom: 0.7rem;
      border-bottom: 1px solid var(--border-soft);
    }
    #r-desc {
      font-family: var(--sans);
      font-size: 0.82rem;
      font-weight: 300;
      color: var(--text);
      line-height: 1.85;
    }
    #r-full-note {
      margin-top: 1rem;
      padding: 0.65rem 0.75rem;
      border: 1px solid var(--border-soft);
      font-size: 0.68rem;
      color: var(--text-dim);
      line-height: 1.6;
    }
    #r-full-note a { color: var(--accent); }
    #r-full-note a:hover { text-decoration: underline; }
    #r-src-notes {
      margin-top: 0.9rem;
      padding-top: 0.7rem;
      border-top: 1px solid var(--border-soft);
      font-size: 0.65rem;
      color: var(--text-dim);
      line-height: 1.55;
    }
    #r-src-notes-head {
      font-size: 0.58rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-dim);
      opacity: 0.5;
      margin-bottom: 0.35rem;
    }
    #r-src-tags { display: flex; gap: 0.3rem; flex-wrap: wrap; margin-top: 0.4rem; }
    #r-xlate-wrap { margin-top: 0.9rem; padding-top: 0.7rem; border-top: 1px solid var(--border-soft); }
    #r-xlate-btn {
      font-size: 0.65rem; color: var(--text-dim);
      border: 1px solid var(--border); padding: 0.18rem 0.5rem;
      display: inline-flex; align-items: center; gap: 0.28rem;
      transition: color 0.1s, border-color 0.1s;
    }
    #r-xlate-btn:hover { color: var(--accent); border-color: var(--accent); }
    #r-xlated {
      margin-top: 0.6rem;
      font-family: var(--sans); font-size: 0.8rem;
      font-weight: 300; color: var(--text); line-height: 1.8;
      display: none;
    }
    #r-xlated.show { display: block; }
    /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 960px) { #reader { display: none !important; } }

    #mob-toggle {
      display: none;
      font-size: 0.72rem;
      color: var(--text-dim);
      border: 1px solid var(--border);
      padding: 0.18rem 0.5rem;
      transition: color 0.1s, border-color 0.1s;
    }
    #mob-toggle:hover { color: var(--accent); border-color: var(--accent); }

    #sidebar-overlay {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      z-index: 90;
    }

    @media (max-width: 640px) {
      #mob-toggle { display: flex; align-items: center; gap: 0.3rem; }

      #sidebar {
        position: fixed;
        top: 0; left: 0;
        height: 100dvh;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.2s ease;
        width: 280px;
        border-right: 1px solid var(--border);
      }
      #sidebar.open {
        transform: translateX(0);
      }
      #sidebar-overlay.open { display: block; }

      #feed-bar { gap: 0.5rem; padding: 0 0.7rem; }
      #feed-name { font-size: 0.7rem; }
      #feed-info { display: none; }

      .article { padding: 0.65rem 0.75rem; }
      #statusbar { padding: 0 0.75rem; gap: 0.8rem; }
    }
    /* â”€â”€ SOURCE INFO TOOLTIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sb-item { position: relative; }
    .sb-info-btn {
      font-size: 0.55rem;
      color: var(--text-dim);
      border: 1px solid var(--border-soft);
      border-radius: 50%;
      width: 14px; height: 14px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.1s, color 0.1s, border-color 0.1s;
      line-height: 1;
    }
    .sb-item:hover .sb-info-btn { opacity: 1; }
    .sb-info-btn:hover { color: var(--accent); border-color: var(--accent); }

    .src-tooltip {
      position: fixed;
      z-index: 200;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      padding: 0.65rem 0.75rem;
      width: 220px;
      font-size: 0.68rem;
      color: var(--text-dim);
      line-height: 1.55;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.12s;
      box-shadow: 0 4px 16px rgba(0,0,0,0.4);
    }
    .src-tooltip.show { opacity: 1; }
    .src-tooltip-name {
      font-size: 0.72rem;
      color: var(--text-bright);
      margin-bottom: 0.3rem;
      font-weight: 500;
    }
    .src-tooltip-tags {
      display: flex; gap: 0.3rem; flex-wrap: wrap;
      margin-bottom: 0.4rem;
    }
    .src-tag {
      font-size: 0.57rem;
      border: 1px solid var(--border);
      color: var(--text-dim);
      padding: 0.05rem 0.28rem;
      letter-spacing: 0.04em;
    }
    .src-tag.state-funded { border-color: #f5c54233; color: #f5c542; }
    .src-tag.wire         { border-color: #4488ff33; color: #4488ff; }
    .src-tag.longform     { border-color: #3df07833; color: var(--accent); }
    .src-tag.independent  { border-color: var(--border); color: var(--text-dim); }

    /* reader save button */
    #r-save-btn {
      font-size: 0.65rem;
      color: var(--text-dim);
      border: 1px solid var(--border);
      padding: 0.12rem 0.4rem;
      transition: color 0.1s, border-color 0.1s;
    }
    #r-save-btn:hover, #r-save-btn.saved { color: var(--accent); border-color: var(--accent); }
    /* â”€â”€ ARTICLE MODAL (mobile) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #article-modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 200;
      background: var(--bg-panel);
      flex-direction: column;
      overflow: hidden;
    }
    #article-modal.open {
      display: flex;
    }
    #modal-top {
      height: 44px;
      flex-shrink: 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 1rem;
      gap: 0.6rem;
    }
    #modal-close {
      font-size: 0.75rem;
      color: var(--text-dim);
      border: 1px solid var(--border);
      padding: 0.25rem 0.6rem;
      min-height: 32px;
      display: flex;
      align-items: center;
    }
    #modal-close:hover { color: var(--accent); border-color: var(--accent); }
    #modal-open {
      font-size: 0.75rem;
      color: var(--text-dim);
      border: 1px solid var(--border);
      padding: 0.25rem 0.6rem;
      min-height: 32px;
      display: flex;
      align-items: center;
      margin-left: auto;
    }
    #modal-open:hover { color: var(--accent); border-color: var(--accent); }
    #modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 1.25rem 1.1rem;
      -webkit-overflow-scrolling: touch;
    }
    #modal-source {
      font-size: 0.68rem;
      color: var(--text-dim);
      margin-bottom: 0.65rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    #modal-src { color: var(--accent); }
    #modal-title {
      font-family: var(--sans);
      font-size: 1.15rem;
      font-weight: 300;
      color: var(--text-bright);
      line-height: 1.45;
      margin-bottom: 0.75rem;
    }
    #modal-date {
      font-size: 0.65rem;
      color: var(--text-dim);
      margin-bottom: 1rem;
      padding-bottom: 0.9rem;
      border-bottom: 1px solid var(--border-soft);
    }
    #modal-desc {
      font-family: var(--sans);
      font-size: 0.92rem;
      font-weight: 300;
      color: var(--text);
      line-height: 1.85;
      margin-bottom: 1.25rem;
    }
    #modal-excerpt-note {
      font-size: 0.7rem;
      color: var(--text-dim);
      border: 1px solid var(--border-soft);
      padding: 0.6rem 0.75rem;
      line-height: 1.55;
      margin-bottom: 1.1rem;
    }
    #modal-excerpt-note a { color: var(--accent); }
    #modal-xlate-wrap {
      margin-top: 0.5rem;
    }
    #modal-xlate-btn {
      font-size: 0.72rem;
      color: var(--text-dim);
      border: 1px solid var(--border);
      padding: 0.25rem 0.6rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      min-height: 32px;
    }
    #modal-xlate-btn:hover { color: var(--accent); border-color: var(--accent); }
    #modal-xlated {
      margin-top: 0.7rem;
      font-family: var(--sans);
      font-size: 0.88rem;
      font-weight: 300;
      color: var(--text);
      line-height: 1.85;
      display: none;
    }
    #modal-xlated.show { display: block; }
    #modal-src-notes {
      margin-top: 1.25rem;
      padding-top: 0.9rem;
      border-top: 1px solid var(--border-soft);
    }
    #modal-src-notes-head {
      font-size: 0.6rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-dim);
      opacity: 0.5;
      margin-bottom: 0.35rem;
    }
    #modal-src-notes-text {
      font-size: 0.72rem;
      color: var(--text-dim);
      line-height: 1.55;
    }
    #modal-src-tags {
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
      margin-top: 0.45rem;
    }
  </style>
</head>
<body>
<div id="topbar">
  <button id="mob-toggle" onclick="toggleMobileSidebar()">â˜° sources</button>
  <div id="wordmark">æ´»å­—</div>
  <div id="search-wrap">
    <input type="search" id="search" placeholder="search headlinesâ€¦" autocomplete="off">
  </div>
  <div id="topbar-right">
    <div id="pulse"></div>
    <div id="updated">â€”</div>
    <button class="t-btn" onclick="doRefresh()">â†º refresh</button>
    <button class="t-btn" id="btn-unread" onclick="toggleUnread()">unread</button>
    <button class="t-btn" id="btn-compact" onclick="toggleCompact()">compact</button>
  </div>
</div>
<div id="sidebar-overlay" onclick="toggleMobileSidebar()"></div>
<div id="layout">
  <div id="sidebar">
    <div class="sb-section" style="border-bottom: 1px solid var(--border-soft);">
      <div class="sb-item active" data-id="all" onclick="doSelect('all')">
        <span class="sb-flag" style="font-size:0.85rem;opacity:0.7">æ´»</span>
        <span class="sb-name">all sources</span>
        <span class="sb-count" id="c-all">â€”</span>
      </div>
      <div class="sb-item" data-id="saved" onclick="doSelect('saved')">
        <span class="sb-flag">â—‡</span>
        <span class="sb-name">saved</span>
        <span class="sb-count" id="c-saved">0</span>
      </div>
    </div>
    <div id="sb-regions"></div>
  </div>
  <div id="main">
    <div id="feed-bar">
      <div id="feed-name">all sources</div>
      <div id="feed-info">loadingâ€¦</div>
      <div id="feed-ctrls">
        <button class="f-btn on" id="s-mixed"  onclick="doSort('mixed')">mixed</button>
        <button class="f-btn"    id="s-recent" onclick="doSort('recent')">latest</button>
        <button class="f-btn"    id="s-source" onclick="doSort('source')">source</button>
      </div>
    </div>
    <div id="articles">
      <div class="state-row"><div class="spinner"></div> fetching feedsâ€¦</div>
    </div>
    <div id="statusbar">
      <div>articles <span id="st-a">â€”</span></div>
      <div>sources <span id="st-s">â€”</span></div>
      <div>languages <span id="st-l">â€”</span></div>
      <div>read <span id="st-r">0</span></div>
    </div>
    <div id="footer">
      <div>
        æ´»å­—
        <span class="footer-sep">â€”</span>
        world press, every angle
      </div>
      <div>
        <a href="https://guilhermegfmachado.github.io/work" target="_blank" rel="noopener">guilherme machado</a>
      </div>
    </div>
  </div>
  <div id="reader" class="hide">
    <div id="reader-top">
      <button class="r-btn" onclick="closeReader()">âœ• close</button>
      <button class="r-btn" id="r-save-btn" onclick="toggleSave(S.active)">â—‡ save</button>
      <button class="r-btn" id="r-open" onclick="openLink()">â†— open article</button>
    </div>
    <div id="reader-body">
      <div id="r-source">
        <span id="r-flag"></span>
        <span id="r-src"></span>
        <span id="r-time"></span>
      </div>
      <div id="r-title"></div>
      <div id="r-date"></div>
      <div id="r-desc"></div>
      <div id="r-full-note">
        This is an RSS excerpt. <a id="r-full-link" href="#" target="_blank" rel="noopener">Read the full article â†—</a>
      </div>
      <div id="r-xlate-wrap">
        <button id="r-xlate-btn" onclick="translateReader()">âŸ³ translate to english</button>
        <div id="r-xlated"></div>
      </div>
      <div id="r-src-notes">
        <div id="r-src-notes-head">about this source</div>
        <div id="r-src-notes-text"></div>
        <div id="r-src-tags"></div>
      </div>
    </div>
  </div>
  <!-- TOOLTIP (shared, positioned by JS) -->
  <div id="src-tooltip" class="src-tooltip">
    <div class="src-tooltip-name" id="tt-name"></div>
    <div class="src-tooltip-tags" id="tt-tags"></div>
    <div id="tt-notes"></div>
  </div>
</div>
<!-- ARTICLE MODAL â€” shown on mobile instead of reader panel -->
<div id="article-modal">
  <div id="modal-top">
    <button id="modal-close" onclick="closeModal()">âœ• back</button>
    <button id="modal-open" onclick="openModalLink()">â†— full article</button>
  </div>
  <div id="modal-body">
    <div id="modal-source">
      <span id="modal-flag"></span>
      <span id="modal-src"></span>
      <span id="modal-time"></span>
    </div>
    <div id="modal-title"></div>
    <div id="modal-date"></div>
    <div id="modal-desc"></div>
    <div id="modal-excerpt-note">
      RSS excerpt only. <a id="modal-full-link" href="#" target="_blank" rel="noopener">Read the full article â†—</a>
    </div>
    <div id="modal-xlate-wrap" style="display:none">
      <button id="modal-xlate-btn" onclick="translateModal()">âŸ³ translate to english</button>
      <div id="modal-xlated"></div>
    </div>
    <div id="modal-src-notes">
      <div id="modal-src-notes-head">about this source</div>
      <div id="modal-src-notes-text"></div>
      <div id="modal-src-tags"></div>
    </div>
  </div>
</div>
<script>
// â”€â”€â”€ FEEDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PROXY = url => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;
const FEEDS = [
  // â”€â”€ WORLD NEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // EUROPE â€” english
  { id:'guardian',    cat:'world-news', name:'The Guardian',           flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Europe',       tags:['independent','longform'], notes:'Centre-left British broadsheet. Strong on environment, global affairs, investigative.',     url:'https://www.theguardian.com/world/rss' },
  { id:'bbc',         cat:'world-news', name:'BBC World',              flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Europe',       tags:['state-funded','wire'],    notes:'UK public broadcaster. Neutral mandate by charter. Broad geographic coverage.',               url:'https://feeds.bbci.co.uk/news/world/rss.xml' },
  { id:'economist',   cat:'world-news', name:'The Economist',          flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Europe',       tags:['independent','longform'], notes:'Economically liberal weekly. Exceptional on finance, trade policy, emerging markets.',         url:'https://www.economist.com/finance-and-economics/rss.xml' },
  { id:'ft',          cat:'world-news', name:'Financial Times',        flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Europe',       tags:['independent','wire'],     notes:'Markets-focused. Best English-language source for European economic policy.',                  url:'https://www.ft.com/rss/home/uk' },
  { id:'dw',          cat:'world-news', name:'Deutsche Welle',         flag:'ðŸ‡©ðŸ‡ª', cc:'DE', lang:'en', region:'Europe',       tags:['state-funded'],           notes:'German public broadcaster in English. Good on Central/Eastern European affairs.',               url:'https://rss.dw.com/rdf/rss-en-world' },
  { id:'rfi',         cat:'world-news', name:'RFI English',            flag:'ðŸ‡«ðŸ‡·', cc:'FR', lang:'en', region:'Europe',       tags:['state-funded'],           notes:'French public radio in English. Strongest African coverage of any source here.',               url:'https://www.rfi.fr/en/rss' },
  // EUROPE â€” french
  { id:'lemonde',     cat:'world-news', name:'Le Monde',               flag:'ðŸ‡«ðŸ‡·', cc:'FR', lang:'fr', region:'Europe',       tags:['independent','longform'], notes:'Newspaper of record in France. Analytical, authoritative, centre-left.',                      url:'https://www.lemonde.fr/rss/une.xml' },
  { id:'liberation',  cat:'world-news', name:'LibÃ©ration',             flag:'ðŸ‡«ðŸ‡·', cc:'FR', lang:'fr', region:'Europe',       tags:['independent'],            notes:'Left-leaning French daily. More opinion-heavy than Le Monde. Good on social issues.',           url:'https://www.liberation.fr/arc/outboundfeeds/rss-all/' },
  { id:'letemps',     cat:'world-news', name:'Le Temps',               flag:'ðŸ‡¨ðŸ‡­', cc:'CH', lang:'fr', region:'Europe',       tags:['independent'],            notes:'Swiss French daily. Liberal, internationally minded. Strong on finance and diplomacy.',         url:'https://www.letemps.ch/articles.rss' },
  // EUROPE â€” german
  { id:'spiegel',     cat:'world-news', name:'Der Spiegel',            flag:'ðŸ‡©ðŸ‡ª', cc:'DE', lang:'de', region:'Europe',       tags:['independent','longform'], notes:'Germany\'s most-read news magazine. Investigative tradition. Centre-left.',                    url:'https://www.spiegel.de/schlagzeilen/index.rss' },
  { id:'zeit',        cat:'world-news', name:'Die Zeit',               flag:'ðŸ‡©ðŸ‡ª', cc:'DE', lang:'de', region:'Europe',       tags:['independent','longform'], notes:'Weekly broadsheet. Long-form, intellectual. Liberal-progressive.',                             url:'https://newsfeed.zeit.de/index' },
  { id:'nzz',         cat:'world-news', name:'Neue ZÃ¼rcher Zeitung',   flag:'ðŸ‡¨ðŸ‡­', cc:'CH', lang:'de', region:'Europe',       tags:['independent'],            notes:'Swiss German daily. Classical liberal, free-market. More conservative than Zeit.',              url:'https://www.nzz.ch/recent.rss' },
  // EUROPE â€” other
  { id:'publico',     cat:'world-news', name:'PÃºblico',                flag:'ðŸ‡µðŸ‡¹', cc:'PT', lang:'pt', region:'Europe',       tags:['independent'],            notes:'Portuguese quality daily. Centre-left. Best domestic source for Portugal/Lusophone world.',    url:'https://feeds.feedburner.com/PublicoRSS' },
  { id:'elpais',      cat:'world-news', name:'El PaÃ­s',                flag:'ðŸ‡ªðŸ‡¸', cc:'ES', lang:'es', region:'Europe',       tags:['independent','longform'], notes:'Spain\'s newspaper of record. Strong on Latin America. Centre-left.',                          url:'https://feeds.elpais.com/mrss-s/pages/ep/site/elpais.com/portada' },
  { id:'repubblica',  cat:'world-news', name:'La Repubblica',          flag:'ðŸ‡®ðŸ‡¹', cc:'IT', lang:'it', region:'Europe',       tags:['independent'],            notes:'Italian daily. Liberal, pro-European. Good on Italian politics and Mediterranean affairs.',    url:'https://www.repubblica.it/rss/homepage/rss2.0.xml' },
  // AMERICAS
  { id:'nyt',         cat:'world-news', name:'New York Times',         flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Americas',     tags:['independent','longform'], notes:'US newspaper of record. Unmatched resources. Centre-left editorial, global reach.',            url:'https://rss.nytimes.com/services/xml/rss/nyt/World.xml' },
  { id:'wapo',        cat:'world-news', name:'Washington Post',        flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Americas',     tags:['independent'],            notes:'DC-focused. Best on US government, national security, foreign policy.',                       url:'https://feeds.washingtonpost.com/rss/world' },
  { id:'ap',          cat:'world-news', name:'Associated Press',       flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Americas',     tags:['wire'],                   notes:'Non-profit wire service. Factual, no editorial line. Feeds most US newspapers.',              url:'https://rsshub.app/apnews/topics/apf-topnews' },
  { id:'folha',       cat:'world-news', name:'Folha de S.Paulo',       flag:'ðŸ‡§ðŸ‡·', cc:'BR', lang:'pt', region:'Americas',     tags:['independent'],            notes:'Brazil\'s most-read quality paper. Essential for Latin American perspective.',                 url:'https://feeds.folha.uol.com.br/mundo/rss091.xml' },
  { id:'lanacion',    cat:'world-news', name:'La NaciÃ³n',              flag:'ðŸ‡¦ðŸ‡·', cc:'AR', lang:'es', region:'Americas',     tags:['independent'],            notes:'Argentina\'s oldest daily. Conservative, business-oriented. Good on Southern Cone.',          url:'https://www.lanacion.com.ar/arc/outboundfeeds/rss/' },
  // ASIA-PACIFIC
  { id:'nhk',         cat:'world-news', name:'NHK World',              flag:'ðŸ‡¯ðŸ‡µ', cc:'JP', lang:'en', region:'Asia-Pacific', tags:['state-funded'],           notes:'Japan\'s public broadcaster in English. Measured, diplomatic. Strong on East Asia.',            url:'https://www3.nhk.or.jp/rss/news/cat0.xml' },
  { id:'asahi',       cat:'world-news', name:'æœæ—¥æ–°èž',                flag:'ðŸ‡¯ðŸ‡µ', cc:'JP', lang:'ja', region:'Asia-Pacific', tags:['independent'],            notes:'Japan\'s second-largest daily. Liberal, pacifist tradition. Read in Japanese.',                url:'https://www.asahi.com/rss/asahi/newsheadlines.rdf' },
  { id:'scmp',        cat:'world-news', name:'S. China Morning Post',  flag:'ðŸ‡­ðŸ‡°', cc:'HK', lang:'en', region:'Asia-Pacific', tags:['independent'],            notes:'Best English-language coverage of China and Southeast Asia.',                                 url:'https://www.scmp.com/rss/91/feed' },
  { id:'thehindu',    cat:'world-news', name:'The Hindu',              flag:'ðŸ‡®ðŸ‡³', cc:'IN', lang:'en', region:'Asia-Pacific', tags:['independent'],            notes:'India\'s newspaper of record. Left-leaning, internationalist. Strong South Asia.',             url:'https://www.thehindu.com/news/international/?service=rss' },
  { id:'smh',         cat:'world-news', name:'Sydney Morning Herald',  flag:'ðŸ‡¦ðŸ‡º', cc:'AU', lang:'en', region:'Asia-Pacific', tags:['independent'],            notes:'Australia\'s oldest daily. Good on Pacific affairs and China-Australia relations.',            url:'https://www.smh.com.au/rss/world.xml' },
  // MENA
  { id:'aljazeera',   cat:'world-news', name:'Al Jazeera',             flag:'ðŸ‡¶ðŸ‡¦', cc:'QA', lang:'en', region:'MENA',         tags:['state-funded'],           notes:'Qatari-funded. Strong Global South perspective. Essential counterpoint to Western framing.',  url:'https://www.aljazeera.com/xml/rss/all.xml' },
  { id:'haaretz',     cat:'world-news', name:'Haaretz',                flag:'ðŸ‡®ðŸ‡±', cc:'IL', lang:'en', region:'MENA',         tags:['independent'],            notes:'Israel\'s oldest daily. Left-liberal. Critical of occupation. Unique domestic perspective.',  url:'https://www.haaretz.com/cmlink/1.4' },
  // â”€â”€ TECHNOLOGY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { id:'mit-tech',    cat:'tech', name:'MIT Tech Review',      flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Analysis',      tags:['independent','longform'], notes:'Rigorous technology journalism from MIT. Best on AI, biotech, and climate tech policy.',     url:'https://www.technologyreview.com/feed/' },
  { id:'ars',         cat:'tech', name:'Ars Technica',          flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Analysis',      tags:['independent'],            notes:'Technical depth rarely found in trade press. Good on computing, science, and policy.',        url:'https://feeds.arstechnica.com/arstechnica/index' },
  { id:'ieee',        cat:'tech', name:'IEEE Spectrum',         flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Institutional', tags:['institutional'],          notes:'Engineering perspective. Underrepresented in most aggregators. Strong on hardware and energy.', url:'https://spectrum.ieee.org/rss/fulltext' },
  { id:'acm',         cat:'tech', name:'ACM TechNews',          flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Institutional', tags:['institutional'],          notes:'Academic computing translated for practitioners. Nothing else covers CS research this broadly.', url:'https://technews.acm.org/rss.xml' },
  { id:'register',    cat:'tech', name:'The Register',          flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Analysis',      tags:['independent'],            notes:'British, sardonic, essential on enterprise, security, and the business of tech.',             url:'https://www.theregister.com/headlines.atom' },
  { id:'rest-world',  cat:'tech', name:'Rest of World',         flag:'ðŸŒ', cc:'--', lang:'en', region:'Analysis',      tags:['independent','longform'], notes:'Technology in the Global South. Completely absent from most tech media.',                     url:'https://restofworld.org/feed/latest' },
  { id:'logic-mag',   cat:'tech', name:'Logic Magazine',        flag:'ðŸŒ', cc:'--', lang:'en', region:'Analysis',      tags:['independent','longform'], notes:'Critical tech journalism. Political economy of technology. Quarterly but dense.',             url:'https://logicmag.io/feed.xml' },
  { id:'schneier',    cat:'tech', name:'Schneier on Security',  flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Blogs',         tags:['independent'],            notes:'Bruce Schneier\'s blog. The most authoritative security and cryptography voice in public.',    url:'https://www.schneier.com/feed/atom/' },
  { id:'hn',          cat:'tech', name:'Hacker News',           flag:'ðŸŒ', cc:'US', lang:'en', region:'Community',     tags:['community'],              notes:'Noisy but collectively intelligent. Nothing else surfaces obscure technical papers like this.', url:'https://hnrss.org/frontpage' },
  // â”€â”€ SCIENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { id:'quanta',      cat:'science', name:'Quanta Magazine',    flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Journalism',   tags:['independent','longform'], notes:'Best science journalism alive. Rigorous and readable. Covers math, physics, biology, CS.',    url:'https://www.quantamagazine.org/feed/' },
  { id:'nature-news', cat:'science', name:'Nature News',        flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Journals',     tags:['institutional'],          notes:'News and comment section of Nature. Not paywalled. Covers high-impact research across all sciences.', url:'https://www.nature.com/nature.rss' },
  { id:'science-mag', cat:'science', name:'Science Magazine',   flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Journals',     tags:['institutional'],          notes:'AAAS journal news section. Peer of Nature. Strong on policy implications of research.',       url:'https://www.science.org/rss/news_current.xml' },
  { id:'new-sci',     cat:'science', name:'New Scientist',      flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Journalism',   tags:['independent'],            notes:'More accessible than Nature/Science. Broader, UK-based. Good on emerging research.',           url:'https://www.newscientist.com/feed/home/' },
  { id:'nautilus',    cat:'science', name:'Nautilus',           flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Journalism',   tags:['independent','longform'], notes:'Long-form, explicitly interdisciplinary. Science, philosophy, and culture in conversation.',   url:'http://nautil.us/rss/all' },
  { id:'phys-org',    cat:'science', name:'Phys.org',           flag:'ðŸŒ', cc:'--', lang:'en', region:'Wire',         tags:['wire'],                   notes:'Wire service for physics, astronomy, chemistry. High volume. Good for breadth.',               url:'https://phys.org/rss-feed/' },
  { id:'arxiv-ai',    cat:'science', name:'arXiv CSÂ·AI',        flag:'ðŸŒ', cc:'--', lang:'en', region:'Preprints',    tags:['institutional'],          notes:'Raw AI preprints. Very noisy, very current. Nothing is more up-to-date on ML research.',       url:'https://rss.arxiv.org/rss/cs.AI' },
  // â”€â”€ HUMANITIES & CULTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { id:'paris-rev',   cat:'humanities', name:'The Paris Review',      flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Literature', tags:['independent','longform'], notes:'Fiction, poetry, and the best author interviews in print. A benchmark of literary culture.',  url:'https://www.theparisreview.org/feed/' },
  { id:'lrb',         cat:'humanities', name:'London Review of Books', flag:'ðŸ‡¬ðŸ‡§', cc:'GB', lang:'en', region:'Essays',    tags:['independent','longform'], notes:'Best long-form intellectual essays in English. Politics, history, literature, art.',          url:'https://www.lrb.co.uk/feeds/articles' },
  { id:'nyrb',        cat:'humanities', name:'NY Review of Books',    flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Essays',    tags:['independent','longform'], notes:'Peer of the LRB. More American in scope. Excellent on history and politics.',                 url:'https://www.nybooks.com/feed/' },
  { id:'eurozine',    cat:'humanities', name:'Eurozine',               flag:'ðŸ‡ªðŸ‡º', cc:'EU', lang:'en', region:'Essays',    tags:['independent','longform'], notes:'Pan-European cultural and political essays. Genuinely multilingual. Unique in scope.',        url:'https://www.eurozine.com/feed/' },
  { id:'aeon',        cat:'humanities', name:'Aeon',                   flag:'ðŸŒ', cc:'--', lang:'en', region:'Essays',    tags:['independent','longform'], notes:'Philosophy, psychology, humanities essays. One of the best general intellectual publications.', url:'https://aeon.co/feed.rss' },
  { id:'public-dom',  cat:'humanities', name:'Public Domain Review',  flag:'ðŸŒ', cc:'--', lang:'en', region:'History',   tags:['independent','longform'], notes:'History of ideas through public domain texts and images. Completely unique.',                  url:'https://publicdomainreview.org/rss.xml' },
  { id:'jstor-daily', cat:'humanities', name:'JSTOR Daily',           flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Essays',    tags:['institutional'],          notes:'Accessible essays drawing on JSTOR content. Good bridge between academic and general reader.', url:'https://daily.jstor.org/feed/' },
  { id:'3qd',         cat:'humanities', name:'3 Quarks Daily',        flag:'ðŸŒ', cc:'US', lang:'en', region:'Curated',   tags:['community'],              notes:'Human-curated links across science, humanities, arts, politics. Editorially opinionated.',    url:'https://3quarksdaily.com/feed' },
  // â”€â”€ ECONOMICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { id:'voxeu',       cat:'economics', name:'VoxEU',                  flag:'ðŸ‡ªðŸ‡º', cc:'EU', lang:'en', region:'Research',     tags:['institutional'],          notes:'Economic research translated for policymakers. By CEPR. Free. Rigorous.',                    url:'https://cepr.org/feed' },
  { id:'proj-syn',    cat:'economics', name:'Project Syndicate',      flag:'ðŸŒ', cc:'--', lang:'en', region:'Opinion',      tags:['independent'],            notes:'Global op-eds from economists and policymakers. Multilingual. Bretton Woods adjacent.',      url:'https://www.project-syndicate.org/rss' },
  { id:'imf-blog',    cat:'economics', name:'IMF Blog',               flag:'ðŸŒ', cc:'--', lang:'en', region:'Institutional', tags:['institutional'],          notes:'Institutional but globally scoped. Good on developing economies and monetary policy.',       url:'https://www.imf.org/en/News/Rss' },
  { id:'marginal-rev',cat:'economics', name:'Marginal Revolution',    flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Blogs',        tags:['independent'],            notes:'Tyler Cowen\'s blog. Idiosyncratic, genuinely broad â€” economics, culture, books, food.',     url:'https://feeds.feedburner.com/marginalrevolution/hJhL' },
  { id:'nber',        cat:'economics', name:'NBER Digest',            flag:'ðŸ‡ºðŸ‡¸', cc:'US', lang:'en', region:'Research',     tags:['institutional'],          notes:'National Bureau of Economic Research working papers digest. Dry but important.',             url:'https://www.nber.org/rss/new_working_papers.xml' },
];
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const S = {
  articles: [],
  saved: new Set(JSON.parse(localStorage.getItem('px_saved') || '[]')),
  read:  new Set(JSON.parse(localStorage.getItem('px_read')  || '[]')),
  feed: 'all', sort: 'mixed',
  unread: false, compact: false,
  query: '', active: null, counts: {},
  fetchedCats: new Set(['world-news']),
  cache: {},
};
const saveSaved = () => localStorage.setItem('px_saved', JSON.stringify([...S.saved]));
const saveRead  = () => localStorage.setItem('px_read',  JSON.stringify([...S.read]));
// â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildSidebar() {
  const cats = [
    { id: 'world-news',  label: 'World News',          icon: 'â—ˆ' },
    { id: 'tech',        label: 'Technology',           icon: 'â—Œ' },
    { id: 'science',     label: 'Science',              icon: 'â—Ž' },
    { id: 'humanities',  label: 'Humanities & Culture', icon: 'â—‡' },
    { id: 'economics',   label: 'Economics',            icon: 'â—«' },
  ];
  const worldOrder = ['Europe','Americas','Asia-Pacific','MENA'];
  const vertOrder  = ['Analysis','Journalism','Institutional','Journals',
                      'Research','Preprints','Wire','Opinion','Blogs',
                      'Essays','Literature','History','Curated','Community'];
  document.getElementById('sb-regions').innerHTML = cats.map(cat => {
    const byRegion = {};
    for (const f of FEEDS.filter(f => f.cat === cat.id))
      (byRegion[f.region] = byRegion[f.region] || []).push(f);
    const order = cat.id === 'world-news' ? worldOrder : vertOrder;
    const regions = order.filter(r => byRegion[r]);
    return `
      <div class="sb-cat-block" data-cat="${cat.id}">
        <div class="sb-cat-header${cat.id === 'world-news' ? ' active' : ''}"
             onclick="toggleCatSection('${cat.id}')">
          <span>${cat.icon}</span>
          <span>${cat.label}</span>
          <span class="sb-cat-toggle" id="ct-${cat.id}">â–¸</span>
        </div>
        <div class="sb-cat-feeds collapsed" id="cf-${cat.id}">
          <div class="sb-item" data-id="${cat.id}" onclick="doSelect('${cat.id}')">
            <span class="sb-flag" style="opacity:0.4">â€”</span>
            <span class="sb-name" style="font-style:italic">all ${cat.label.toLowerCase()}</span>
          </div>
          ${regions.map(region => `
            <div class="sb-head">${region}</div>
            ${byRegion[region].map(f => `
              <div class="sb-item" data-id="${f.id}" onclick="doSelect('${f.id}')">
                <span class="sb-cc">${f.cc || '--'}</span>
                <span class="sb-name">${f.name}</span>
                <span class="sb-lang">${f.lang}</span>
                ${f.notes ? `<button class="sb-info-btn"
                  onmouseenter="showTooltip(event,'${f.id}')"
                  onmouseleave="hideTooltip()"
                  onclick="event.stopPropagation()">?</button>` : ''}
                <span class="sb-count" id="c-${f.id}">Â·</span>
              </div>`).join('')}
          `).join('')}
        </div>
      </div>`;
  }).join('');
}
function toggleCatSection(catId) {
  const feeds = document.getElementById('cf-' + catId);
  const toggle = document.getElementById('ct-' + catId);
  const isCollapsed = feeds.classList.toggle('collapsed');
  toggle.textContent = isCollapsed ? 'â–¸' : 'â–¾';
  if (!isCollapsed && !S.fetchedCats.has(catId)) {
    loadCategory(catId, true);
  }
}
// â”€â”€â”€ FETCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const stripHtml = s => { const d = document.createElement('div'); d.innerHTML = s; return (d.textContent||'').replace(/\s+/g,' ').trim(); };
const ago = ts => { const s=(Date.now()-ts)/1000; if(s<60) return Math.floor(s)+'s'; if(s<3600) return Math.floor(s/60)+'m'; if(s<86400) return Math.floor(s/3600)+'h'; return Math.floor(s/86400)+'d'; };
async function fetchOne(f) {
  try {
    const r = await fetch(PROXY(f.url));
    if (!r.ok) throw 0;
    const d = await r.json();
    if (d.status !== 'ok') throw 0;
    return (d.items||[]).map(i => ({
      id:      i.guid||i.link||Math.random().toString(36),
      feedId:  f.id,
      cat:     f.cat,
      name:    f.name,
      flag:    f.flag,
      cc:      f.cc || '--',
      lang:    f.lang,
      title:   i.title||'',
      desc:    i.description ? stripHtml(i.description).slice(0,400) : '',
      link:    i.link||'',
      date:    i.pubDate ? +new Date(i.pubDate) : Date.now(),
      readMin: Math.max(1, Math.round((i.description ? stripHtml(i.description).split(/\s+/).length : 50) / 200)),
    }));
  } catch { return []; }
}
async function loadCategory(cat, silent = false) {
  if (S.fetchedCats.has(cat) && cat !== 'all') return;
  S.fetchedCats.add(cat);
  const feeds = cat === 'all' ? FEEDS : FEEDS.filter(f => f.cat === cat);
  if (!silent) {
    document.getElementById('articles').innerHTML =
      `<div class="state-row"><div class="spinner"></div> fetching ${feeds.length} feedsâ€¦</div>`;
  }
  const res = await Promise.allSettled(feeds.map(fetchOne));
  let newArticles = [];
  res.forEach((r, i) => {
    if (r.status !== 'fulfilled') return;
    newArticles.push(...r.value);
    S.counts[feeds[i].id] = r.value.length;
    const el = document.getElementById('c-' + feeds[i].id);
    if (el) el.textContent = r.value.length || 'Â·';
  });
  const existing = new Set(S.articles.map(a => a.title.toLowerCase().slice(0,50)));
  newArticles = newArticles.filter(a => {
    const k = a.title.toLowerCase().slice(0,50);
    if (existing.has(k)) return false;
    existing.add(k); return true;
  });
  S.articles.push(...newArticles);
  S.articles.sort((a,b) => b.date - a.date);
  document.getElementById('c-all').textContent = S.articles.length;
  document.getElementById('updated').textContent = 'updated just now';
  updateStats(); render();
}
function refresh() {
  S.articles = [];
  S.fetchedCats = new Set();
  S.counts = {};
  loadCategory('world-news');
}
// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CATS = new Set(['world-news','tech','science','humanities','economics']);
function visible() {
  let a = S.articles;
  if (S.feed === 'saved') {
    a = a.filter(x => S.saved.has(x.id));
  } else if (S.feed === 'all') {
    // show all fetched so far
  } else if (CATS.has(S.feed)) {
    a = a.filter(x => x.cat === S.feed);
  } else {
    a = a.filter(x => x.feedId === S.feed);
  }
  if (S.unread) a = a.filter(x => !S.read.has(x.id));
  if (S.query) { const q=S.query.toLowerCase(); a = a.filter(x => x.title.toLowerCase().includes(q)||x.desc.toLowerCase().includes(q)); }
  if (S.sort === 'source') {
    a = [...a].sort((x,y) => x.name.localeCompare(y.name));
  } else if (S.sort === 'recent') {
    a = [...a].sort((x,y) => y.date - x.date);
  } else {
    a = interleave([...a]);
  }
  return a;
}
// â”€â”€â”€ FEED ORDERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function decayScore(article) {
  const hoursOld = (Date.now() - article.date) / 3_600_000;
  return 1 / Math.pow(hoursOld + 2, 1.4);
}
function interleave(articles) {
  const bySource = {};
  for (const a of articles) {
    if (!bySource[a.feedId]) bySource[a.feedId] = [];
    bySource[a.feedId].push(a);
  }
  for (const q of Object.values(bySource)) q.sort((a,b) => decayScore(b) - decayScore(a));
  const queues = Object.values(bySource).sort((a,b) => decayScore(b[0]) - decayScore(a[0]));
  const result = [];
  let active = queues.filter(q => q.length > 0);
  while (active.length > 0) {
    for (const q of active) if (q.length) result.push(q.shift());
    active = active.filter(q => q.length > 0);
  }
  return result;
}
const esc = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
function render() {
  const list = visible();
  const wrap = document.getElementById('articles');
  wrap.className = S.compact ? 'compact' : '';
  if (!list.length) { wrap.innerHTML = '<div id="empty">no articles</div>'; return; }
  wrap.innerHTML = list.map(a => {
    const isSaved = S.saved.has(a.id);
    const langBadge = a.lang !== 'en'
      ? `<span class="a-lang">${a.lang}</span>` : '';
    const xlateAction = a.lang !== 'en'
      ? `<button class="a-action-btn" onclick="event.stopPropagation();inlineXlate(this,'${esc(a.title)}','${a.lang}')">âŸ³ translate</button>` : '';
    return `<div class="article${S.read.has(a.id)?' read':''}${S.active===a.id?' active':''}"
                 data-id="${esc(a.id)}"
                 onclick="openReader('${esc(a.id)}')">
      <div class="a-meta">
        <span class="a-cc">${esc(a.cc||'--')}</span>
        <span class="a-src">${esc(a.name)}</span>
        ${langBadge}
        <span class="a-dot">Â·</span>
        <span class="a-time">${ago(a.date)}</span>
        <span class="a-dot">Â·</span>
        <span class="a-read-time">${a.readMin||1}m</span>
      </div>
      <div class="a-title">${esc(a.title)}</div>
      <div class="a-desc">${esc(a.desc)}</div>
      <div class="a-actions">
        <button class="a-action-btn${isSaved?' saved':''}"
          onclick="event.stopPropagation();toggleSave('${esc(a.id)}')">${isSaved?'â—† saved':'â—‡ save'}</button>
        <span class="a-dot">Â·</span>
        <a class="a-open-link" href="${esc(a.link)}" target="_blank" rel="noopener"
          onclick="event.stopPropagation()">â†— open</a>
        ${xlateAction ? `<span class="a-dot">Â·</span>${xlateAction}` : ''}
      </div>
    </div>`;
  }).join('');
}
// â”€â”€â”€ CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doSelect(id) {
  S.feed = id;
  document.getElementById('sidebar')?.classList.remove('open');
  document.getElementById('sidebar-overlay')?.classList.remove('open');
  const mt = document.getElementById('mob-toggle');
  if (mt) mt.textContent = 'â˜°';
  document.querySelectorAll('.sb-item').forEach(el =>
    el.classList.toggle('active', el.dataset.id === id));
  const f = FEEDS.find(x => x.id === id);
  const catLabels = {
    'world-news': 'world news', 'tech': 'technology',
    'science': 'science', 'humanities': 'humanities & culture',
    'economics': 'economics'
  };
  if (id === 'all') {
    document.getElementById('feed-name').textContent = 'all sources';
    document.getElementById('feed-info').textContent =
      `${S.articles.length} articles Â· ${FEEDS.length} sources`;
  } else if (id === 'saved') {
    document.getElementById('feed-name').textContent = 'saved';
    document.getElementById('feed-info').textContent = `${S.saved.size} saved`;
  } else if (catLabels[id]) {
    document.getElementById('feed-name').textContent = catLabels[id];
    const catArticles = S.articles.filter(x => x.cat === id);
    const catFeeds = FEEDS.filter(x => x.cat === id);
    document.getElementById('feed-info').textContent =
      `${catArticles.length} articles Â· ${catFeeds.length} sources`;
    if (!S.fetchedCats.has(id)) { loadCategory(id); return; }
  } else {
    document.getElementById('feed-name').textContent = f?.name || id;
    document.getElementById('feed-info').textContent = `${S.counts[id] || 0} articles`;
    if (f && !S.fetchedCats.has(f.cat)) { loadCategory(f.cat); return; }
  }
  render();
}
function doSort(s) {
  S.sort = s;
  document.getElementById('s-mixed').classList.toggle('on',  s==='mixed');
  document.getElementById('s-recent').classList.toggle('on', s==='recent');
  document.getElementById('s-source').classList.toggle('on', s==='source');
  render();
}
function toggleUnread()  { S.unread=!S.unread;  document.getElementById('btn-unread').classList.toggle('on',S.unread);  render(); }
function toggleCompact() { S.compact=!S.compact; document.getElementById('btn-compact').classList.toggle('on',S.compact); render(); }
function doRefresh() { refresh(); }
function updateStats() {
  document.getElementById('st-a').textContent = S.articles.length;
  document.getElementById('st-s').textContent = new Set(S.articles.map(a=>a.feedId)).size;
  document.getElementById('st-l').textContent = new Set(S.articles.map(a=>a.lang)).size;
  document.getElementById('st-r').textContent = S.read.size;
  document.getElementById('c-saved').textContent = S.saved.size;
}
function toggleSave(id) {
  if (S.saved.has(id)) { S.saved.delete(id); } else { S.saved.add(id); }
  saveSaved();
  document.getElementById('c-saved').textContent = S.saved.size;
  // update the button in place without full re-render
  const card = document.querySelector(`.article[data-id="${id}"] .a-action-btn`);
  if (card) {
    const now = S.saved.has(id);
    card.classList.toggle('saved', now);
    card.textContent = now ? 'â—† saved' : 'â—‡ save';
  }
  // also update reader save button if open
  const rBtn = document.getElementById('r-save-btn');
  if (rBtn && S.active === id) {
    const now = S.saved.has(id);
    rBtn.classList.toggle('saved', now);
    rBtn.textContent = now ? 'â—† saved' : 'â—‡ save';
  }
}
// â”€â”€â”€ READER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openReader(id) {
  const a = S.articles.find(x => x.id===id); if (!a) return;
  S.active = id; S.read.add(id); saveRead();
  document.getElementById('st-r').textContent = S.read.size;
  document.querySelectorAll('.article').forEach(el => {
    el.classList.toggle('active', el.dataset.id===id);
    if (el.dataset.id===id) el.classList.remove('read');
  });
  if (window.innerWidth <= 640) { openModal(a); return; }
  document.getElementById('r-flag').textContent = a.flag;
  document.getElementById('r-src').textContent  = a.name;
  document.getElementById('r-time').textContent = ' Â· '+ago(a.date);
  document.getElementById('r-title').textContent = a.title;
  document.getElementById('r-date').textContent  = new Date(a.date).toLocaleString();
  document.getElementById('r-desc').textContent  = a.desc||'â€”';
  document.getElementById('r-xlated').className = '';
  document.getElementById('r-xlated').textContent = '';
  document.getElementById('r-xlate-btn').textContent = 'âŸ³ translate to english';
  document.getElementById('r-xlate-wrap').style.display = a.lang!=='en' ? '' : 'none';

  // full article link
  document.getElementById('r-full-link').href = a.link;

  // source notes
  const feed = FEEDS.find(f => f.id === a.feedId);
  document.getElementById('r-src-notes-text').textContent = feed?.notes || '';
  document.getElementById('r-src-tags').innerHTML = (feed?.tags||[]).map(t =>
    `<span class="src-tag ${t}">${t}</span>`
  ).join('');

  const isSaved = S.saved.has(id);
  const rSave = document.getElementById('r-save-btn');
  rSave.classList.toggle('saved', isSaved);
  rSave.textContent = isSaved ? 'â—† saved' : 'â—‡ save';
  document.getElementById('reader').classList.remove('hide');
}
function closeReader() {
  document.getElementById('reader').classList.add('hide'); S.active=null;
  document.querySelectorAll('.article.active').forEach(el => el.classList.remove('active'));
}
function openLink() { const a=S.articles.find(x=>x.id===S.active); if(a) window.open(a.link,'_blank','noopener'); }
// â”€â”€â”€ MOBILE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(a) {
  document.getElementById('modal-flag').textContent = a.flag;
  document.getElementById('modal-src').textContent  = a.name;
  document.getElementById('modal-time').textContent = ' Â· '+ago(a.date);
  document.getElementById('modal-title').textContent = a.title;
  document.getElementById('modal-date').textContent  = new Date(a.date).toLocaleString();
  document.getElementById('modal-desc').textContent  = a.desc||'â€”';
  document.getElementById('modal-xlated').className = '';
  document.getElementById('modal-xlated').textContent = '';
  document.getElementById('modal-xlate-btn').textContent = 'âŸ³ translate to english';
  document.getElementById('modal-xlate-wrap').style.display = a.lang!=='en' ? '' : 'none';
  document.getElementById('modal-full-link').href = a.link;
  const feed = FEEDS.find(f => f.id === a.feedId);
  document.getElementById('modal-src-notes-text').textContent = feed?.notes || '';
  document.getElementById('modal-src-tags').innerHTML = (feed?.tags||[]).map(t =>
    `<span class="src-tag ${t}">${t}</span>`
  ).join('');
  document.getElementById('article-modal').classList.add('open');
}
function closeModal() {
  document.getElementById('article-modal').classList.remove('open');
  S.active = null;
  document.querySelectorAll('.article.active').forEach(el => el.classList.remove('active'));
}
function openModalLink() { const a=S.articles.find(x=>x.id===S.active); if(a) window.open(a.link,'_blank','noopener'); }
async function translateModal() {
  const a=S.articles.find(x=>x.id===S.active); if(!a) return;
  const btn=document.getElementById('modal-xlate-btn');
  btn.textContent='âŸ³ translatingâ€¦';
  const res=await xlate(a.title+'\n\n'+a.desc, a.lang);
  if (res) { document.getElementById('modal-xlated').textContent=res; document.getElementById('modal-xlated').className='show'; btn.textContent='âœ“ translated'; }
  else btn.textContent='âœ— failed';
}
// â”€â”€â”€ TRANSLATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function xlate(text, from='auto') {
  try {
    const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${from}&tl=en&dt=t&q=${encodeURIComponent(text)}`);
    const d = await r.json();
    return d[0].map(s=>s[0]).join('');
  } catch { return null; }
}
async function translateReader() {
  const a=S.articles.find(x=>x.id===S.active); if(!a) return;
  const btn=document.getElementById('r-xlate-btn');
  btn.textContent='âŸ³ translatingâ€¦';
  const res=await xlate(a.title+'\n\n'+a.desc, a.lang);
  if (res) { document.getElementById('r-xlated').textContent=res; document.getElementById('r-xlated').className='show'; btn.textContent='âœ“ translated'; }
  else btn.textContent='âœ— failed';
}
async function inlineXlate(btn, title, lang) {
  btn.textContent='âŸ³ â€¦';
  const res=await xlate(title, lang);
  if (res) { btn.textContent=res; btn.style.opacity='1'; btn.style.color='var(--text-dim)'; btn.onclick=null; }
  else btn.textContent='âœ—';
}

// â”€â”€â”€ MOBILE SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleMobileSidebar() {
  const sb = document.getElementById('sidebar');
  const ov = document.getElementById('sidebar-overlay');
  const open = sb.classList.toggle('open');
  ov.classList.toggle('open', open);
  document.getElementById('mob-toggle').textContent = open ? 'âœ• close' : 'â˜° sources';
}
// â”€â”€â”€ SOURCE TOOLTIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showTooltip(e, feedId) {
  const f = FEEDS.find(x => x.id === feedId);
  if (!f) return;
  const tt = document.getElementById('src-tooltip');
  document.getElementById('tt-name').textContent = f.name;
  document.getElementById('tt-notes').textContent = f.notes || '';
  document.getElementById('tt-tags').innerHTML = (f.tags||[]).map(t =>
    `<span class="src-tag ${t}">${t}</span>`
  ).join('');
  // position to the right of the sidebar
  const rect = e.target.getBoundingClientRect();
  tt.style.left = (rect.right + 8) + 'px';
  tt.style.top  = Math.min(rect.top, window.innerHeight - 160) + 'px';
  tt.classList.add('show');
}
function hideTooltip() {
  document.getElementById('src-tooltip').classList.remove('show');
}
// â”€â”€â”€ KEYBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const searchEl = document.getElementById('search');
searchEl.addEventListener('input', e => { S.query=e.target.value.trim(); render(); });
document.addEventListener('keydown', e => {
  if (e.key==='/' && document.activeElement!==searchEl) { e.preventDefault(); searchEl.focus(); }
  if (e.key==='Escape') { if(document.activeElement===searchEl) searchEl.blur(); else { closeModal(); closeReader(); } }
});
// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
buildSidebar();
loadCategory('world-news');
</script>
</body>
</html>
